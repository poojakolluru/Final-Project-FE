<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Manage ALM (Questions Upload)</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap');
  :root { --accent1:#4db6ac; --accent2:#81c784; --muted:#b8e0d6; --danger:#D32F2F; }

  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    color: #333;
    display: flex;
    height: 100vh;
    overflow-x: hidden;
  }

  /* Toggle Button */
  .toggle-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: linear-gradient(45deg, #ff6b9d, #c44569);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease, background 0.3s ease;
  }

  .toggle-btn:hover { transform: scale(1.1); }

  /* Sidebar */
  .sidebar {
    width: 280px; background: linear-gradient(180deg, #81c784 0%, #4db6ac 100%);
    padding: 20px 0; position: fixed; height: 100%;
    left: 0; top: 0; overflow-y: auto; transition: 0.4s;
    border-radius: 0 20px 20px 0;
  }

  .sidebar.collapsed { width: 70px; }
  .sidebar h2 { text-align: center; color: #fff; margin-bottom: 25px; }

  .nav-item { list-style: none; margin: 15px 0; }
  .nav-link {
    display: flex; align-items: center; padding: 15px 20px;
    color: white; text-decoration: none; border-radius: 15px;
    margin: 0 10px; transition: 0.3s;
  }
  .nav-link:hover { background: rgba(255,255,255,0.2); }

  .nav-link i { margin-right: 15px; font-size: 1.5em; }
  .sidebar.collapsed .nav-link span { display: none; }

  .dropdown-menu {
    list-style: none;
    background: white;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: 0.4s;
    border-radius: 10px;
    margin-left: 20px;
  }
  .dropdown.open .dropdown-menu {
    max-height: 300px;
    opacity: 1;
  }

  /* Main Content */
  .main-content {
    margin-left: 280px;
    padding: 80px 20px 20px;
    flex: 1;
  }

  .main-content.collapsed { margin-left: 70px; }

  .container {
    background: white; padding: 22px; border-radius: 12px;
    max-width: 1100px; margin: auto; box-shadow: 0 6px 25px rgba(0,0,0,0.08);
  }
/* Form Container */
#formWrap {
    background: #ffffff;
    padding: 25px;
    border-radius: 18px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.08);
    margin-top: 20px;
    animation: fadeIn 0.4s ease;
}

/* Label Style */
#formWrap label {
    display: block;
    font-weight: 500;
    margin-bottom: 6px;
    color: #333;
    font-size: 15px;
}

/* Inputs & Selects */
#formWrap input,
#formWrap select {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid #cfd8dc;
    font-size: 15px;
    outline: none;
    margin-bottom: 18px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    background: #fafafa;
}

/* Focus effect */
#formWrap input:focus,
#formWrap select:focus {
    border-color: var(--accent1);
    box-shadow: 0 0 8px rgba(77, 182, 172, 0.4);
    background: white;
}

/* Buttons */
#formWrap .button-row {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 10px;
}

#formWrap .button-row .btn {
    flex: 1;
    height: 50px;
    font-size: 16px;
}


/* Two-Column Layout */
#formWrap .row {
    display: flex;
    gap: 25px;
}

#formWrap .col {
    flex: 1;
}

/* File input */
#almFile {
    padding: 8px;
    background: #fff;
    border: 1px dashed #9e9e9e;
}

/* Fade animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

  .row { display:flex; gap:16px; flex-wrap:wrap; }
  .col { flex:1 1 300px; }

  .btn {
    padding: 10px 16px; border-radius: 8px; border: none;
    background: linear-gradient(135deg,var(--accent1),#388e3c);
    color: white; cursor: pointer;
    margin-left:10px;
    
    
  }

  .btn.secondary { background: #7e22ce; }

  table { width:100%; border-collapse:collapse; margin-top:18px; }
  th,td { padding:10px; border:1px solid #e0e0e0; }
  .center { text-align:center; }
  .actions span { cursor:pointer; font-size:22px; margin:0 4px; }
</style>
</head>

<body>

<button class="toggle-btn" id="toggle-btn">‚ò∞</button>

 <nav class="sidebar" id="sidebar">
        <div class="logo-container">
            <img src="images/logo4.png" alt="Logo" style="width:100%;height:168px;">
        </div>
        <h2>Dashboard</h2>
        <ul>
            <li class="nav-item">
                <a href="index.html" class="nav-link"><i>üè†</i><span>Home</span></a>
            </li>
            <li class="nav-item dropdown" id="analytics">
                <a href="#" class="nav-link dropdown-toggle"><i>üìö</i><span>Courses</span></a>
                <ul class="dropdown-menu">
                    <li><a href="add_courses.html">Add Course</a></li>
                    <li><a href="add_assignment.html">Assignments</a></li>
                    <li><a href="alm.html">ALM</a></li>
                     <li><a href="quiz.html">Conduct Quizz</a></li>
                
                </ul>
                <li class="nav-item">
                <a href="add_student.html" class="nav-link"><i>üè†</i><span>Enrollments</span></a>
            </li>
            </li>
            <li class="nav-item dropdown" id="users">
                <a href="grade.html" class="nav-link dropdown-toggle"><i>üìä</i><span>Grade</span></a>
                <!-- <ul class="dropdown-menu">
                    <li><a href="#">Manage Users</a></li>
                    <li><a href="#">Permissions</a></li>
                    <li><a href="#">Profiles</a></li>
                </ul> -->
            </li>
            <!-- <li class="nav-item">
                <a href="#" class="nav-link"><i>‚öôÔ∏è</i><span>Settings</span></a>
            </li> -->
        </ul>
    </nav>

<main class="main-content" id="main-content">

<div class="container">
  <h1 style="text-align:center;color:var(--accent1)">Assignments</h1>

  <div class="switch"><button class="btn" id="toggleViewBtn" style="float:right">Show Table</button></div>

  <!-- FORM -->
  <div id="formWrap">
    <div class="row">
      <div class="col">
        <label>Subject</label>
        <select id="almSubject">
          <option value="">-- Select --</option>
          <option>Computer networking</option><option>Probability & Statatics</option>
          <option>Java</option><option>Python</option><option>DBMS</option><option>FrontEnd FrameWork</option><option>DBMS</option>
         </select>

        <label>Title</label>
        <input type="text" id="almTitle">

        <label>Start</label>
        <input type="datetime-local" id="almStart">

        <label>End</label>
        <input type="datetime-local" id="almEnd">
      </div>

      <div class="col">
        <label>Upload Questions</label>
        <input type="file" id="almFile" accept=".pdf,.doc,.docx,.ppt,.pptx" style="width:90%;margin-left: 10px;">

        <label>Notes</label>
        <input type="text" id="almNotes" STYLE="width:90%;margin-bottom: 30px;margin-left: 10px;;">

        <button class="btn" id="saveAlmBtn">Save ALM</button>
        <button class="btn secondary" id="resetFormBtn">Reset</button>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div id="tableWrap" style="display:none;">
    <div style="display:flex;justify-content:space-between;">
      
        
      <button class="btn" id="addAlmBtn" style="height:38px;float:right">‚ûï Add Assignment</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Subject</th><th>Title</th><th>Start‚ÜíEnd</th>
          <th>File</th><th>Notes</th><th>Status</th><th class="center">Actions</th>
        </tr>
      </thead>
      <tbody id="almBody"></tbody>
    </table>

    <div class="center" style="margin-top:12px;">
      <button class="btn" id="clearAllBtn">Clear All</button>
    </div>

  </div>

</div>

</main>

<script>
/* SIDEBAR */
document.getElementById("toggle-btn").onclick = () => {
  sidebar.classList.toggle("collapsed");
  main-content.classList.toggle("collapsed");
};

/* DROPDOWN */
document.querySelectorAll(".dropdown-toggle").forEach(el=>{
  el.onclick = (e)=>{ e.preventDefault(); el.parentElement.classList.toggle("open"); }
});

/* ALM SCRIPT */
const LS_KEY = "alms";
let editIndex = -1;

const almBody = document.getElementById("almBody");
const formWrap = document.getElementById("formWrap");
const tableWrap = document.getElementById("tableWrap");
const toggleViewBtn = document.getElementById("toggleViewBtn");

function loadAlms(){
  const alms = JSON.parse(localStorage.getItem(LS_KEY)) || [];
  renderTable(alms);
}
loadAlms();

function renderTable(alms){
  almBody.innerHTML = "";
  const now = new Date();

  alms.forEach((a,idx)=>{
    let sd = a.start ? new Date(a.start).toLocaleString() : "‚Äî";
    let ed = a.end ? new Date(a.end).toLocaleString() : "‚Äî";

    almBody.innerHTML += `
  <tr>
    <td>${a.subject}</td>
    <td>${a.title}</td>
    <td>${sd} ‚Üí ${ed}</td>
    <td>${a.fileName || "‚Äî"}</td>
    <td>${a.notes || ""}</td>
    <td>ACTIVE</td>
    <td class="center actions">
      <span onclick="editAlm(${idx})">‚úèÔ∏è</span>
      <span onclick="deleteAlm(${idx})">üóëÔ∏è</span>
      <span onclick="downloadAlm(${idx})">‚¨áÔ∏è</span>
    </td>
  </tr>`;

  });
}

toggleViewBtn.onclick = () => {
  if(formWrap.style.display !== "none"){
    formWrap.style.display = "none";
    tableWrap.style.display = "block";
    toggleViewBtn.textContent = "Show Form";
  } else {
    tableWrap.style.display = "none";
    formWrap.style.display = "block";
    toggleViewBtn.textContent = "Show Table";
  }
};

document.getElementById("addAlmBtn").onclick = () => {
  resetForm();
  formWrap.style.display = "block";
  tableWrap.style.display = "none";
  toggleViewBtn.textContent = "Show Table";
};

function resetForm(){
  almSubject.value = "";
  almTitle.value = "";
  almStart.value = "";
  almEnd.value = "";
  almFile.value = "";
  almNotes.value = "";
  editIndex = -1;
  saveAlmBtn.textContent = "Save ALM";
}

document.getElementById("saveAlmBtn").onclick = async ()=>{

  const subject = almSubject.value.trim();
  const title = almTitle.value.trim();

  if(!subject || !title) return alert("Fill all fields");

  let entry = {
    subject, title,
    start: almStart.value,
    end: almEnd.value,
    notes: almNotes.value.trim()
  };

  const f = almFile.files[0];
if (f) {
    entry.fileName = f.name;
    entry.fileType = f.type;

    // Convert file ‚Üí Base64
    entry.fileData = await new Promise((resolve) => {
        let reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(f);
    });
}


  let alms = JSON.parse(localStorage.getItem(LS_KEY)) || [];
  if(editIndex === -1) alms.push(entry);
  else alms[editIndex] = entry;

  localStorage.setItem(LS_KEY, JSON.stringify(alms));

  resetForm();
  renderTable(alms);

  formWrap.style.display = "none";
  tableWrap.style.display = "block";
  toggleViewBtn.textContent = "Show Form";
};

window.editAlm = (idx)=>{
  let alms = JSON.parse(localStorage.getItem(LS_KEY)) || [];
  let a = alms[idx];

  almSubject.value = a.subject;
  almTitle.value = a.title;
  almStart.value = a.start;
  almEnd.value = a.end;
  almNotes.value = a.notes;

  editIndex = idx;
  saveAlmBtn.textContent = "Update ALM";

  formWrap.style.display = "block";
  tableWrap.style.display = "none";
};

window.deleteAlm = (idx)=>{
  if(!confirm("Delete this?")) return;

  let alms = JSON.parse(localStorage.getItem(LS_KEY)) || [];
  alms.splice(idx,1);
  localStorage.setItem(LS_KEY, JSON.stringify(alms));
  renderTable(alms);
};

document.getElementById("clearAllBtn").onclick = ()=>{
  if(confirm("Clear ALL?")){
    localStorage.removeItem(LS_KEY);
    renderTable([]);
  }
};
window.downloadAlm = (idx) => {
    let alms = JSON.parse(localStorage.getItem(LS_KEY)) || [];
    let a = alms[idx];

    if (!a.fileData) {
        alert("No file uploaded for this record.");
        return;
    }

    // Create download link
    let link = document.createElement("a");
    link.href = a.fileData;     
    link.download = a.fileName || "ALM_File";  
    document.body.appendChild(link);
    link.click();
    link.remove();
};

</script>

</body>
</html>
